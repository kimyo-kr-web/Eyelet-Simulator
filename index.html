<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KIMYO Wallet Customizing</title>
  <!-- Pretendard -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/variable/pretendardvariable.css" />
  <style>
    body {
      margin: 0;
      background: black;
      color: white;
      font-family: Helvetica, Pretendard, sans-serif;
      text-align: center;
      overflow-x: hidden;
    }

    .container {
      width: 100%;
      max-width: 100%;
      padding: 5vw;
      box-sizing: border-box;
    }

    h1 { font-size: 12vw; margin: 5vw auto 2vw; }
    h2 { font-size: 6vw; margin: 0 auto 6vw; }

    .desc {
      font-size: 4vw;
      margin: 0 auto 5vw;
      line-height: 1.4;
    }

    .wallet {
      width: 90vw;
      aspect-ratio: 1631 / 1089; /* 원본 비율 유지 */
      margin: 0 auto;
      background: #111;
      border: 0.5vw solid white;
      position: relative;
      overflow: hidden;
      border-radius: 1vw;
    }

    .note { font-size: 3vw; margin: 3vw auto; }

    .eyelets {
      display: flex;
      justify-content: center;
      gap: 10vw;
      margin: 8vw 0;
    }

    .eyeletA, .eyeletB {
      border: 0.5vw solid white;
      border-radius: 50%;
      cursor: pointer;
      flex-shrink: 0;
    }

    .eyeletA { width: 12vw; height: 12vw; }
    .eyeletB { width: 25vw; height: 25vw; }

    .eyelet-label { font-size: 4vw; margin-top: 2vw; }

    .input-box {
      width: 90vw;
      border: 0.5vw solid white;
      margin: 5vw auto;
      padding: 2vw;
      font-size: 4vw;
      background: black;
      color: white;
    }

    input {
      width: 100%;
      background: transparent;
      border: none;
      font-size: 4vw;
      color: white;
      text-align: center;
      font-family: Pretendard, sans-serif;
    }
    input:focus { outline: none; }

    .btn-group {
      display: flex;
      justify-content: center;
      gap: 5vw;
      margin: 5vw 0;
    }

    .btn {
      flex: 1;
      max-width: 40vw;
      border: 0.5vw solid white;
      padding: 3vw 0;
      font-size: 4vw;
      cursor: pointer;
      font-family: Pretendard, sans-serif;
      border-radius: 1vw;
    }
    .btn:hover { background: white; color: black; }

    /* 드래그된 아일렛 */
    .draggable {
      position: absolute;
      cursor: move;
    }

    .delete-btn {
      position: absolute;
      top: -3vw;
      right: -3vw;
      width: 6vw;
      height: 6vw;
      background: red;
      color: white;
      border-radius: 50%;
      font-size: 4vw;
      line-height: 6vw;
      text-align: center;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>KIMYO</h1>
    <h2>Wallet Customizing</h2>

    <div class="desc">
      아일렛은 총 7개 까지 배치할 수 있어요.<br>
      검은 사각형은 지갑 영역입니다. 아일렛을 드래그하여 배치하세요.
    </div>

    <div class="wallet" id="wallet"></div>

    <div class="note">* 커스터마이징 시뮬레이터 (비율 동일)</div>

    <div class="eyelets">
      <div>
        <div class="eyeletA" onclick="addEyelet('A')"></div>
        <div class="eyelet-label">Type A</div>
      </div>
      <div>
        <div class="eyeletB" onclick="addEyelet('B')"></div>
        <div class="eyelet-label">Type B</div>
      </div>
    </div>

    <div class="input-box">
      <input type="text" id="userText" placeholder="성명 + 휴대폰 뒷자리 입력">
    </div>

    <div class="btn-group">
      <div class="btn" onclick="resetWallet()">리셋</div>
      <div class="btn" onclick="downloadWallet()">다운로드</div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    let eyeletCount = 0;

    function addEyelet(type) {
      if (eyeletCount >= 7) return alert("아일렛은 최대 7개까지 가능합니다.");
      const wallet = document.getElementById('wallet');
      const eyelet = document.createElement('div');
      eyelet.classList.add('draggable');
      eyelet.style.width = type === 'A' ? '12vw' : '25vw';
      eyelet.style.height = type === 'A' ? '12vw' : '25vw';
      eyelet.style.border = '0.5vw solid white';
      eyelet.style.borderRadius = '50%';
      eyelet.style.left = "40%";
      eyelet.style.top = "40%";

      // 삭제 버튼
      const del = document.createElement('div');
      del.className = "delete-btn";
      del.innerText = "×";
      del.onclick = () => { eyelet.remove(); eyeletCount--; };
      eyelet.appendChild(del);

      wallet.appendChild(eyelet);
      makeDraggable(eyelet);
      eyeletCount++;
    }

    function makeDraggable(el) {
      let offsetX, offsetY, isDown = false;

      // 마우스 이벤트
      el.addEventListener('mousedown', e => {
        if (e.target.classList.contains('delete-btn')) return;
        isDown = true;
        offsetX = e.offsetX;
        offsetY = e.offsetY;
      });

      document.addEventListener('mousemove', e => {
        if (!isDown) return;
        el.style.left = (e.pageX - wallet.offsetLeft - offsetX) + 'px';
        el.style.top = (e.pageY - wallet.offsetTop - offsetY) + 'px';
      });

      document.addEventListener('mouseup', () => { isDown = false; });

      // 터치 이벤트 (모바일)
      el.addEventListener('touchstart', e => {
        if (e.target.classList.contains('delete-btn')) return;
        isDown = true;
        const touch = e.touches[0];
        const rect = el.getBoundingClientRect();
        offsetX = touch.clientX - rect.left;
        offsetY = touch.clientY - rect.top;
      });

      document.addEventListener('touchmove', e => {
        if (!isDown) return;
        const touch = e.touches[0];
        el.style.left = (touch.pageX - wallet.offsetLeft - offsetX) + 'px';
        el.style.top = (touch.pageY - wallet.offsetTop - offsetY) + 'px';
      });

      document.addEventListener('touchend', () => { isDown = false; });
    }

    function resetWallet() {
      document.getElementById('wallet').innerHTML = "";
      eyeletCount = 0;
    }

    function downloadWallet() {
      const wallet = document.getElementById('wallet');
      wallet.querySelectorAll('.delete-btn').forEach(btn => btn.style.display = "none");

      const text = document.getElementById('userText').value;
      const textDiv = document.createElement('div');
      textDiv.style.position = "absolute";
      textDiv.style.bottom = "2vw";
      textDiv.style.left = "50%";
      textDiv.style.transform = "translateX(-50%)";
      textDiv.style.fontSize = "4vw";
      textDiv.style.fontFamily = "Pretendard, sans-serif";
      textDiv.innerText = text;
      wallet.appendChild(textDiv);

      html2canvas(wallet).then(canvas => {
        const link = document.createElement('a');
        link.download = "wallet.png";
        link.href = canvas.toDataURL();
        link.click();
        textDiv.remove();
        wallet.querySelectorAll('.delete-btn').forEach(btn => btn.style.display = "block");
      });
    }
  </script>
</body>
</html>
